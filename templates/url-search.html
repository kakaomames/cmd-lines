<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>URLæ¢ç´¢ãƒ•ã‚©ãƒ¼ãƒ ã¨çµæœè¡¨ç¤º</title>
    <style>
        body { font-family: sans-serif; }
        .log-container { background-color: #f4f4f4; border: 1px solid #ddd; padding: 15px; margin-top: 20px; white-space: pre-wrap; font-family: monospace; font-size: 14px; }
        .json-output { background-color: #e6e6ff; border: 1px solid #aaa; padding: 15px; margin-top: 20px; white-space: pre-wrap; font-family: monospace; font-size: 14px; }
        .content-preview { 
            border: 2px solid #333; 
            margin-top: 20px; 
            height: 300px; 
            overflow: auto; 
            padding: 10px; 
            background-color: white; 
        }
    </style>
    <link rel="stylesheet" href="https://kakaomames.github.io/Minecraft-flask-app/static/style.css">
</head>
<body>
    <h1>URLæ¢ç´¢âœ¨</h1>
        <nav>
            <ul>
                <li><a href="/home">ãƒ›ãƒ¼ãƒ </a></li>
                <li><a href="/h">GITHUBã«ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ä¿å­˜</a></li>
                <li><a href="/cmd">Webã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œãƒ„ãƒ¼ãƒ«</a></li>
                <br>
                <li><a href="/run?cmd=">ç›´æ¥ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã—ãŸã„æ–¹å‘ã‘...</a></li>
                <li><a href="/link">URLæ¤œç´¢âœ¨</a></li>
                <li><a href="/url-dl">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ€ãƒ¼</a></li>
                <br>
                <li><a href="/ikkatu-url">ğŸ”—ä¸€æ‹¬URLãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ€ãƒ¼ğŸ”—</a></li>
                <li><a href="/games">ã‚²ãƒ¼ãƒ ğŸ‘¿</a></li>
                
            </ul>
        </nav>
    <form id="linkForm">
        <input type="text" name="url" id="urlInput" placeholder="URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (ä¾‹: https://example.com)" size="50" required>
        <button type="submit">æ¢ç´¢ğŸš€</button>
    </form>

    <div id="loading" style="display:none; color: blue; margin-top: 10px;">å‡¦ç†ä¸­... ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚â³</div>

    <div id="results" style="margin-top: 30px; display:none;">
        <h2>ğŸ“ JSON ãƒ¬ã‚¹ãƒãƒ³ã‚¹</h2>
        <pre class="json-output" id="jsonOutput"></pre>
        
        <h2>ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ­ã‚° (NL / logs)</h2>
        <pre class="log-container" id="networkLog"></pre>

        <h2>ğŸ“„ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ (Base64ã‹ã‚‰ãƒ‡ã‚³ãƒ¼ãƒ‰ã—è¡¨ç¤º)</h2>
        <p id="htmlStatus"></p>
        <div class="content-preview" id="contentPreview"></div>
    </div>

    <script>
        document.getElementById('linkForm').addEventListener('submit', async function(e) {
            e.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«

            const url = document.getElementById('urlInput').value;
            const loading = document.getElementById('loading');
            const resultsDiv = document.getElementById('results');
            const jsonOutput = document.getElementById('jsonOutput');
            const networkLog = document.getElementById('networkLog');
            const contentPreview = document.getElementById('contentPreview');
            const htmlStatus = document.getElementById('htmlStatus');

            loading.style.display = 'block';
            resultsDiv.style.display = 'none';

            try {
                // /curl ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                const response = await fetch(`/curl?url=${encodeURIComponent(url)}`);
                const json = await response.json();

                // JSONå…¨ä½“ã‚’è¡¨ç¤º
                jsonOutput.textContent = JSON.stringify(json, null, 2);
                
                const data = json.data;

                // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ­ã‚°ã‚’è¡¨ç¤º
                networkLog.textContent = data.NL || data.logs || 'ãƒ­ã‚°ãªã—';

                // Base64ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰
                // Base64ã¯ASCIIæ–‡å­—ã®ã¿ãªã®ã§ã€ãƒ‡ã‚³ãƒ¼ãƒ‰ã¯å®‰å…¨ã«è¡Œãˆã¾ã™
                const decodedContent = atob(data.code);
                
                // HTMLãƒªãƒ©ã‚¤ãƒˆæƒ…å ±
                const isRewritten = json.data.is_html_rewritten;
                htmlStatus.innerHTML = isRewritten 
                    ? 'ğŸ’¡ **HTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„**ãŒæ¤œå‡ºã•ã‚Œã€**ç›¸å¯¾ãƒ‘ã‚¹**ãŒ**çµ¶å¯¾URL**ã«å¤‰æ›ã•ã‚Œã¾ã—ãŸã€‚'
                    : 'ï¼ˆHTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã¯ãªã„ã€ã¾ãŸã¯ãƒªãƒ©ã‚¤ãƒˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ï¼‰';
                
                // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦è¡¨ç¤º (preã‚¿ã‚°ã§ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰è¡¨ç¤ºã®ã‚ˆã†ã«æ‰±ã†)
                contentPreview.textContent = decodedContent;
                
                // çµæœã‚’è¡¨ç¤º
                resultsDiv.style.display = 'block';

            } catch (error) {
                // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šãªã©ã®ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
                jsonOutput.textContent = `ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`;
                networkLog.textContent = `ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚`;
                resultsDiv.style.display = 'block';
            } finally {
                loading.style.display = 'none';
            }
        });
    </script>
    <script>
    // DOMè¦ç´ ã‚’å–å¾—ã—ã¦ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¡¨ç¤ºã™ã‚‹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€‚ãªãã¦ã‚‚æ©Ÿèƒ½ã™ã‚‹ãŒã€ç¢ºèªã®ãŸã‚ã«ã‚ã‚‹ã¨ä¾¿åˆ©ï¼‰
    const statusElement = document.getElementById('status');

    /**
     * Service Worker ã®ç™»éŒ²å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°
     */
    function registerServiceWorker() {
        // 1. Service Worker APIãŒãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèª
        if ('serviceWorker' in navigator) {
            
            // 2. ãƒšãƒ¼ã‚¸å…¨ä½“ã®ãƒ­ãƒ¼ãƒ‰å®Œäº†ã‚’å¾…ã£ã¦ã‹ã‚‰ç™»éŒ²ã‚’é–‹å§‹ (æ¨å¥¨ã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°)
            window.addEventListener('load', () => {
                
                // /sw.js ã®ãƒ‘ã‚¹ã§ Service Worker ã‚’ç™»éŒ²ã—ã¾ã™ã€‚
                // Service Worker ã®ã‚¹ã‚³ãƒ¼ãƒ—ã¯ã€ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª(/)ã¨ãªã‚Šã¾ã™ã€‚
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        // ç™»éŒ²æˆåŠŸæ™‚ã®å‡¦ç†
                        console.log('Service Worker ç™»éŒ²æˆåŠŸ:', registration.scope);
                        if (statusElement) {
                            statusElement.textContent = `Service Worker ç™»éŒ²æˆåŠŸ ğŸ‰ (Scope: ${registration.scope})`;
                        }
                    })
                    .catch(error => {
                        // ç™»éŒ²å¤±æ•—æ™‚ã®å‡¦ç†
                        console.error('Service Worker ç™»éŒ²å¤±æ•—:', error);
                        if (statusElement) {
                            statusElement.textContent = `Service Worker ç™»éŒ²å¤±æ•— ğŸ˜¢: ${error.message}`;
                        }
                    });
            });
        } else {
            // Service Worker ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„ãƒ–ãƒ©ã‚¦ã‚¶ã®å ´åˆ
            console.warn('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ Service Worker ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚');
            if (statusElement) {
                statusElement.textContent = 'ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ Service Worker ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚';
            }
        }
    }

    // ç™»éŒ²é–¢æ•°ã‚’å®Ÿè¡Œ
    registerServiceWorker();
</script>
</body>
</html>
